/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
plugins {
    id "base"
    id "java"
    id "maven"  //uploadArchives
    //定义在org.example.greeting.properties
    id 'org.example.greeting'
}

group 'org.test'
version '1.0-SNAPSHOT'

//apply plugin: org.example.greeting.GreetingPlugin

task copy(type: Copy, group: "Custom", description: "Copies sources to the dest directory") {
    //from, into 是AbstractCopyTask的基类方法
    from "src"
    into "build"
}

hello {
    //任务已经在apply plugin时加入，这里是配置任务参数
    message = "ccccccccc"
}

task zip(type: Zip, group: "Archive", description: "Archives sources in a zip file", dependsOn: hello) {
    //这里大括号内是配置任务，不是真正执行task
    //doLast, doFirst是执行操作的顺序
    //from,getArchiveFileName,getDestinationDirectory是Zip的基类AbstractCopyTask的方法,用来配置Zip的任务参数

    doLast {
        println("eeeeeeeee")
    }
    doFirst {
        println("bbbbbbbbb")
    }
    println("aaaaaaaaa")

    from "src"
    getArchiveFileName().set("basic-demo-2.0.zip")
    getDestinationDirectory().set(new File("dest"))

}

//uploadArchives是java插件提供的task, taskType是Upload
uploadArchives {
    //repositories是任务类型Upload的属性
    //mavenDeployer是repositories的代理类RepositoryHandler的方法,这个方法由maven插件提供，如下
    //GroovyMavenDeployer mavenDeployer(Map<String, ?> args, Closure configureClosure)
    repositories.mavenDeployer {
        //这里设置GroovyMavenDeployer的属性
        //repository是DefaultGroovyMavenDeployer的方法，返回一个RemoteRepository
        //url是RemoteRepository的属性 //()小括号里url是设置返回对象的属性
        //authentication也是RemoteRepository的子类MavenRemoteRepository的方法，这里是创建了一个authentication对象属性
            
        //repository(url: "file://C:\\Users\\Administrator\\.m2\\repository")
        //repositary when Version policy = Snapshot
        repository(url: "http://localhost:8081/repository/maven-snapshots/") {
            //可以看出这
            println it.url
            it.authentication(userName: "admin", password: "admin123")
        }
    }
}